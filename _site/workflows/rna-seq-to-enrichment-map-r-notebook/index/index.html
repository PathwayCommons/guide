<!DOCTYPE html>

<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      RNA-Seq to Enrichment Map - R Notebook &middot; Guide
    
  </title>

  <!-- Icons -->
  <link rel="shortcut icon" href="/guide/media/favicon.ico">

  <!-- CSS -->
  
  <!-- Third-party CSS -->
  <link rel="stylesheet" type="text/css" href="/guide/public/bower_components/bootstrap/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="/guide/public/bower_components/progress-tracker/app/styles/progress-tracker.css" />
  <link rel="stylesheet" type="text/css" href="/guide/public/bower_components/font-awesome/css/font-awesome.min.css" />

  <!-- Custom CSS -->
  <link rel="stylesheet" href="/guide/public/css/main.css">

  <!-- Javascript -->
  <!-- Third-party javascript -->
  <script type="text/javascript" src="/guide/public/bower_components/jquery/dist/jquery.min.js"></script>
  <script type="text/javascript" src="/guide/public/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="/guide/public/bower_components/cytoscape/dist/cytoscape.min.js"></script>
  <script type="text/javascript" src="/guide/public/js/deps.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    MathJax.Hub.Config({ TeX: { equationNumbers: { autoNumber: "AMS" } } });
  </script>
  <!-- Custom javascript -->
  <script type="text/javascript" src="/guide/public/js/babel-compiled.js" defer></script>
  
</head>


  <body class="theme-base-01">
    <a name="top"></a>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <nav class="sidebar-nav">
    <div class="sidebar-item">
      Guide: v0.1.0
    </div>
    <a class="sidebar-nav-item" href="/guide/">Home</a>

    

    
    
      <!-- List items with a valid title and page layout -->
      
        

          
          <a class="sidebar-nav-item"
          href="/guide/case_studies/archive/">Case studies
          </a>

        
      
    
      <!-- List items with a valid title and page layout -->
      
    
      <!-- List items with a valid title and page layout -->
      
        

          
          <a class="sidebar-nav-item"
          href="/guide/presentations/archive/">Presentations
          </a>

        
      
    
      <!-- List items with a valid title and page layout -->
      
        

          
          <a class="sidebar-nav-item"
          href="/guide/primers/archive/">Primers
          </a>

        
      
    
      <!-- List items with a valid title and page layout -->
      
        

          
          <a class="sidebar-nav-item active"
          href="/guide/workflows/archive/">Workflows
          </a>

        
      
    
  </nav>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
    <div class="masthead">
  <div class="container">
    <h3 class="masthead-title">
      <a href="/guide/" title="Home">Guide</a>
      <small>
        <a href="http://www.pathwaycommons.org/">&middot; Pathway Commons</a>
        
      </small>
      <span class="pull-right">
        <small class="contact">
          <a href="https://groups.google.com/forum/#!forum/pathway-commons-help" target="_blank">Contact Us</a>
        </small>
      </span>
    </h3>
  </div>
</div>


      <div class="container content">
        <div id='ajax-spinner'><img src="/guide/media/spinner.gif"/></div>
        <div class="page">
    
  
    

    
    
    <ol class="breadcrumb">
    
      

      <!-- we can only handle 1 nesting -->
      
        <li><a href="/guide/">Guide</a></li>
      
    
      

      <!-- we can only handle 1 nesting -->
      
        <li><a href="/guide/workflows/archive/">Workflows</a></li>
      
    
      

      <!-- we can only handle 1 nesting -->
      
    
      

      <!-- we can only handle 1 nesting -->
      
        
          <li class="active">RNA-Seq to Enrichment Map - R Notebook</li>
        
      
    
    </ol>
  


  
  <div class="alert alert-danger">Draft Content</div>
  

  <h1 class="page-title">RNA-Seq to Enrichment Map - R Notebook</h1>
  <div class="collection">
  <div class="document">
    <div class="subtitle"><em>Process platelet RNA-Seq data, identify altered pathways then visualize using Enrichment Map</em></div>
    <div class="date"><em>2017-08-01</em></div>
    <hr/>
    <div class="linkout clearfix">
      <ul class="list-inline pull-right">
      <li>
  <a href="http://twitter.com/intent/tweet?text=Process platelet RNA-Seq data, identify altered pathways then visualize ...+http://pathwaycommons.github.io/guide/workflows/rna-seq-to-enrichment-map-r-notebook/index/&via=pathwaycommons"
  data-toggle="tooltip"
  title="Tweet this page"
  target="_blank" >
    <i class="fa fa-twitter-square fa-2x"></i>
  </a>
</li>
<li>
  <a href="https://plus.google.com/share?url=http://pathwaycommons.github.io/guide/workflows/rna-seq-to-enrichment-map-r-notebook/index/"
  data-toggle="tooltip"
  title="Share on Google+"
  target="_blank" >
    <i class="fa fa-google-plus fa-2x"></i>
  </a>
</li>

      <li></li>
      
        
<li>
  <a data-toggle="tooltip"
    title="View PDF"
    href="/guide/media/workflows/rna-seq-to-enrichment-map-r-notebook/index/true">
    <i class="fa fa-file-pdf-o fa-2x" aria-hidden="true"></i>
  </a>
</li>


      
      </ul>
    </div>
    <hr/>
    <div class="alert alert-info">
  This is an <a href="http://rmarkdown.rstudio.com/r_notebooks.html" target="_blank">R Notebook</a> distilled from the pathway enrichment analysis workflow entitled 'RNA-Seq to Enrichment Map'
</div>

<h2 id="a-overview">A. Overview</h2>

<p>This R Notebook documents a comparison mRNA levels between two conditions and uses this information to identify and then visualize pathway-level differences. In particular, you will use convert RNA-Seq count data into a single ranked list where genes are ordered according to their differential expression. Enriched pathways from this list are distilled using <a href="http://software.broadinstitute.org/gsea/index.jsp">Gene Set Enrichment Analysis (GSEA)</a> then visualized as an <a href="http://journals.plos.org/plosone/article?id=10.1371/journal.pone.0013984">Enrichment Map</a>.</p>

<h3 id="software-requirements">Software requirements</h3>

<p>We will be using the following R packages along the way so please do install before beginning.</p>

<ul>
  <li>BioConductor
    <ul>
      <li><a href="https://bioconductor.org/packages/release/bioc/html/SummarizedExperiment.html"><code class="highlighter-rouge">SummarizedExperiment</code></a></li>
      <li><a href="https://bioconductor.org/packages/release/bioc/html/edgeR.html"><code class="highlighter-rouge">edgeR</code></a></li>
    </ul>
  </li>
  <li>CRAN
    <ul>
      <li><a href="https://cran.r-project.org/web/packages/devtools/README.html"><code class="highlighter-rouge">devtools</code></a></li>
    </ul>
  </li>
</ul>

<h2 id="b-sample-study">B. Sample Study</h2>

<p>In this workflow we will use expression data collected in a study by Myron G. Best and colleagues (Best 2015) whose aim was to differentiate blood platelets from healthy donors (HD) to those diagnosed with a breast cancer (BrCa) towards a proof-of-principle for blood-based cancer diagnosis.</p>

<h3 id="rationale">Rationale</h3>

<p>The primary physiological role of platelets is to sense and accumulate at the sites of damaged endothelial tissue and initiate a blood clot to mitigate and vessel leakage (Semple 2011). Previous observations are consistent with the notion that platelets have close contact with cancer cells - a process termed ‘education’ - and may play a role in their metastatic potential (Gay 2011). Diversity in tumour-educated platelets (TEP) could be clinically relevant if they enable discrimination between different stages of a malignancy.</p>

<h3 id="rna-seq-data">RNA-Seq Data</h3>

<p>Best <em>et al.</em> collected blood platelets from 55 HD and from 39 individuals with BrCa and subjected these samples to RNA-sequencing. Herein, we will be restricting our attention to a subset of 5 patient samples from each class. The metadata for the RNA-Seq files is contained in a file named <code class="highlighter-rouge">tep_rnaseq_metadata.txt</code> which lists RNA-Seq data filenames (‘id’) and ‘class’ of each patient sample (Table I).
Let us begin by loading the required R packages we’ll need in this R Notebook.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r">  <span class="c1">### Declare general file directory paths
</span>  <span class="n">base_dir</span> <span class="o">&lt;-</span> <span class="n">getwd</span><span class="p">()</span>
  <span class="n">data_dir</span> <span class="o">&lt;-</span> <span class="n">file.path</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="s2">"data"</span><span class="p">)</span>

  <span class="c1">### Declare paths to RNA-Seq (meta)data files
</span>  <span class="n">tep_rnaseq_metadata</span> <span class="o">&lt;-</span> <span class="n">file.path</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">"tep_rnaseq_metadata.txt"</span><span class="p">)</span>
  <span class="n">tep_rnaseq_filelist</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">(</span><span class="n">file.path</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">"MGH-BrCa-H-74_htsqct.txt"</span><span class="p">),</span>
                           <span class="n">file.path</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">"MGH-BrCa-H-68_htsqct.txt"</span><span class="p">),</span>
                           <span class="n">file.path</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">"MGH-BrCa-H-66_htsqct.txt"</span><span class="p">),</span>
                           <span class="n">file.path</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">"MGH-BrCa-H-59_htsqct.txt"</span><span class="p">),</span>
                           <span class="n">file.path</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">"MGH-BrCa-H-11_htsqct.txt"</span><span class="p">),</span>
                           <span class="n">file.path</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">"HD-5_htsqct.txt"</span><span class="p">),</span>
                           <span class="n">file.path</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">"HD-4_htsqct.txt"</span><span class="p">),</span>
                           <span class="n">file.path</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">"HD-3-1_htsqct.txt"</span><span class="p">),</span>
                           <span class="n">file.path</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">"HD-2-1_htsqct.txt"</span><span class="p">),</span>
                           <span class="n">file.path</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">"HD-1_htsqct.txt"</span><span class="p">))</span></code></pre></figure>

<p><strong>Table I. Patient TEP RNA-Seq metadata (<code class="highlighter-rouge">tep_rnaseq_metadata.txt</code>)</strong></p>

<figure class="highlight"><pre><code class="language-r" data-lang="r">  <span class="n">tep_rnaseq_metadata_df</span> <span class="o">&lt;-</span> <span class="n">read.table</span><span class="p">(</span><span class="n">tep_rnaseq_metadata</span><span class="p">,</span><span class="n">header</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">)</span>
  <span class="n">knitr</span><span class="o">::</span><span class="n">kable</span><span class="p">(</span><span class="n">tep_rnaseq_metadata_df</span><span class="p">,</span> <span class="n">caption</span><span class="o">=</span><span class="s2">"Table I. Patient TEP RNA-Seq metadata (tep_rnaseq_metadata.txt)"</span><span class="p">)</span></code></pre></figure>

<table>
  <thead>
    <tr>
      <th style="text-align: left">id</th>
      <th style="text-align: left">class</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">MGH-BrCa-H-74_htsqct.txt</td>
      <td style="text-align: left">BrCa</td>
    </tr>
    <tr>
      <td style="text-align: left">MGH-BrCa-H-68_htsqct.txt</td>
      <td style="text-align: left">BrCa</td>
    </tr>
    <tr>
      <td style="text-align: left">MGH-BrCa-H-66_htsqct.txt</td>
      <td style="text-align: left">BrCa</td>
    </tr>
    <tr>
      <td style="text-align: left">MGH-BrCa-H-59_htsqct.txt</td>
      <td style="text-align: left">BrCa</td>
    </tr>
    <tr>
      <td style="text-align: left">MGH-BrCa-H-11_htsqct.txt</td>
      <td style="text-align: left">BrCa</td>
    </tr>
    <tr>
      <td style="text-align: left">HD-5_htsqct.txt</td>
      <td style="text-align: left">HD</td>
    </tr>
    <tr>
      <td style="text-align: left">HD-4_htsqct.txt</td>
      <td style="text-align: left">HD</td>
    </tr>
    <tr>
      <td style="text-align: left">HD-3-1_htsqct.txt</td>
      <td style="text-align: left">HD</td>
    </tr>
    <tr>
      <td style="text-align: left">HD-2-1_htsqct.txt</td>
      <td style="text-align: left">HD</td>
    </tr>
    <tr>
      <td style="text-align: left">HD-1_htsqct.txt</td>
      <td style="text-align: left">HD</td>
    </tr>
  </tbody>
</table>

<p>Each RNA-Seq record is a tab-delimited text file contains 57 736 rows: The first column holds an <a href="http://www.ensembl.org/info/genome/genebuild/genome_annotation.html">Ensembl gene</a> ID and the second column a read count for transcripts mapped. An excerpt of raw data for sample <code class="highlighter-rouge">HD-1_htsqct.txt</code> is shown below in Table II. Note the absence of a header.</p>

<p><strong>Table II. Excerpt of RNA-Seq file HD-1_htsqct.txt</strong></p>

<figure class="highlight"><pre><code class="language-r" data-lang="r">  <span class="n">index_HD_1_htsqct</span> <span class="o">&lt;-</span> <span class="n">grepl</span><span class="p">(</span><span class="s2">"HD-1_htsqct.txt"</span><span class="p">,</span> <span class="n">tep_rnaseq_filelist</span><span class="p">)</span>
  <span class="n">rnaseq_HD_1_htsqct</span> <span class="o">&lt;-</span> <span class="n">read.table</span><span class="p">(</span><span class="n">tep_rnaseq_filelist</span><span class="p">[</span><span class="n">index_HD_1_htsqct</span><span class="p">],</span>
    <span class="n">check.names</span><span class="o">=</span><span class="n">FALSE</span><span class="p">)</span>
  <span class="n">knitr</span><span class="o">::</span><span class="n">kable</span><span class="p">(</span><span class="n">head</span><span class="p">(</span><span class="n">rnaseq_HD_1_htsqct</span><span class="p">),</span>
    <span class="n">caption</span><span class="o">=</span><span class="s2">"Excerpt of RNA-Seq file HD-1_htsqct.txt"</span><span class="p">,</span> <span class="n">col.names</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="s2">""</span><span class="p">))</span></code></pre></figure>

<table>
  <thead>
    <tr>
      <th style="text-align: left"> </th>
      <th style="text-align: right"> </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">ENSG00000000003</td>
      <td style="text-align: right">0</td>
    </tr>
    <tr>
      <td style="text-align: left">ENSG00000000005</td>
      <td style="text-align: right">0</td>
    </tr>
    <tr>
      <td style="text-align: left">ENSG00000000419</td>
      <td style="text-align: right">100</td>
    </tr>
    <tr>
      <td style="text-align: left">ENSG00000000457</td>
      <td style="text-align: right">6</td>
    </tr>
    <tr>
      <td style="text-align: left">ENSG00000000460</td>
      <td style="text-align: right">11</td>
    </tr>
    <tr>
      <td style="text-align: left">ENSG00000000938</td>
      <td style="text-align: right">159</td>
    </tr>
  </tbody>
</table>

<h2 id="c-data-pre-processing">C. Data Pre-Processing</h2>

<p>At the end of this section we wish to have the RNA-Seq data into a format that we can more easily pipe into our differential gene expression testing procedure.</p>

<h3 id="gene-identifier-mapping">Gene identifier mapping</h3>

<p>We need to translate Ensembl identifiers (Table II) to a corresponding <a href="http://www.genenames.org/">HGNC</a> approved symbol, when available. This is neccessary in order to have our gene names match up with the pathway-associated gene identifiers used in our pathway enrichment analysis. It may not always be possible to perform this mapping, in which case, we simply omit the gene from any of our RNA-Seq data moving forward.</p>

<h3 id="rna-seq-data-merging">RNA-Seq data merging</h3>

<p>We will take the individual RNA-Seq data files and merge them and any associated metadata into a single object, the <a href="https://bioconductor.org/packages/release/bioc/vignettes/SummarizedExperiment/inst/doc/SummarizedExperiment.html">SummarizedExperiment</a>.</p>

<blockquote>
  <p>A SummarizedExperiment stores experimental assays as a rectangular array whose rows correspond to the (genomic) ranges and whose columns correspond to the different samples. The SummarizedExperiment class stores metadata on the rows and columns. Metadata on the samples usually include experimental or observational covariates … Row metadata comprise the start and end coordinates of each feature and the identifier of the containing polymer, for example, the chromosome name. (Huber 2015)</p>
</blockquote>

<hr />

<p>With these tasks in mind, we will offload the work onto a function <code class="highlighter-rouge">emRNASeq::merge_data</code> that performs the required ID-mapping and data merging and returns a single <code class="highlighter-rouge">SummarizedExperiment</code> instance. The relevant help documentation is reproduced below.</p>

<div class="alert alert-info">
  merge_data {emRNASeq}
  <br /><br />

  <h4>Merge a set of files representing RNA sequencing gene counts</h4>
  <br />

  <h5>Description</h5>
  <p>1. Default parameter is do nothing (already matching gene set ids) 2. Optional parameter is to map from input to target namespace. Data files must be in tab-delimited format with two columns and no header. The classes are defined by a meta data file which is a tab-delimited text file with headers for the sample read 'id' and 'class'. Each row entry is a corresponding filename and class assignment. Only accepts pair-wise comparison so there must be exactly 2 classes.</p>
  <br />

  <h5>Usage</h5>
  <p><code>merge_data(tep_rnaseq_metadata, species, source_name, target_name, ...)</code></p>
  <br />

  <h5>Arguments</h5>
  <p><code>metadata_file</code>	A metadata file</p>
  <p><code>species</code> A character array indicating the species with which to fetch gene models from bioMart, If NULL this mapping will not be performed</p>
  <p><code>source_name</code>	attribute (gene namespace) input</p>
  <p><code>target_name</code>	attribute (gene namespace) desired</p>
  <br />

  <h5>Value</h5>
  <p>A SummarizedExperiment</p>
</div>

<p>Let’s use our package to perform the ID-mapping and data merging.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r">  <span class="n">library</span><span class="p">(</span><span class="n">devtools</span><span class="p">)</span>
  <span class="n">library</span><span class="p">(</span><span class="s2">"SummarizedExperiment"</span><span class="p">)</span>
  <span class="n">devtools</span><span class="o">::</span><span class="n">install_github</span><span class="p">(</span><span class="s2">"jvwong/emRNASeq"</span><span class="p">)</span>

  <span class="n">source_name</span> <span class="o">&lt;-</span> <span class="s2">"ensembl_gene_id"</span>
  <span class="n">target_name</span> <span class="o">&lt;-</span> <span class="s2">"hgnc_symbol"</span>
  <span class="n">species</span> <span class="o">&lt;-</span> <span class="s2">"human"</span>

  <span class="n">brca_hd_tep_se</span> <span class="o">&lt;-</span> <span class="n">emRNASeq</span><span class="o">::</span><span class="n">merge_data</span><span class="p">(</span>
    <span class="n">tep_rnaseq_metadata</span><span class="p">,</span>
    <span class="n">species</span><span class="p">,</span>
    <span class="n">source_name</span><span class="p">,</span>
    <span class="n">target_name</span><span class="p">,</span>
    <span class="n">tep_rnaseq_filelist</span><span class="p">)</span></code></pre></figure>

<p>The result of the merge is a <code class="highlighter-rouge">SummarizedExperiment</code> object named <code class="highlighter-rouge">brca_hd_tep_se</code>.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r">  <span class="n">brca_hd_tep_se</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## class: RangedSummarizedExperiment 
## dim: 34996 10 
## metadata(0):
## assays(1): counts
## rownames(34996): RNU6-871P MIR626 ... RNA5SP302 RNU6-179P
## rowData names(1): ensembl_gene_id
## colnames(10): MGH-BrCa-H-74_htsqct MGH-BrCa-H-68_htsqct ...
##   HD-2-1_htsqct HD-1_htsqct
## colData names(1): class</code></pre></figure>

<p>The <code class="highlighter-rouge">SummarizedExperiment</code> package provides a number of helpful accessor functions to examine the data.</p>

<p>For instance, we can take a peek at the column (sample) metadata using the <code class="highlighter-rouge">SummarizedExperiment::colData</code> function.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r">  <span class="n">knitr</span><span class="o">::</span><span class="n">kable</span><span class="p">(</span><span class="n">SummarizedExperiment</span><span class="o">::</span><span class="n">colData</span><span class="p">(</span><span class="n">brca_hd_tep_se</span><span class="p">))</span></code></pre></figure>

<table>
  <thead>
    <tr>
      <th style="text-align: left"> </th>
      <th style="text-align: left">class</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">MGH-BrCa-H-74_htsqct</td>
      <td style="text-align: left">BrCa</td>
    </tr>
    <tr>
      <td style="text-align: left">MGH-BrCa-H-68_htsqct</td>
      <td style="text-align: left">BrCa</td>
    </tr>
    <tr>
      <td style="text-align: left">MGH-BrCa-H-66_htsqct</td>
      <td style="text-align: left">BrCa</td>
    </tr>
    <tr>
      <td style="text-align: left">MGH-BrCa-H-59_htsqct</td>
      <td style="text-align: left">BrCa</td>
    </tr>
    <tr>
      <td style="text-align: left">MGH-BrCa-H-11_htsqct</td>
      <td style="text-align: left">BrCa</td>
    </tr>
    <tr>
      <td style="text-align: left">HD-5_htsqct</td>
      <td style="text-align: left">HD</td>
    </tr>
    <tr>
      <td style="text-align: left">HD-4_htsqct</td>
      <td style="text-align: left">HD</td>
    </tr>
    <tr>
      <td style="text-align: left">HD-3-1_htsqct</td>
      <td style="text-align: left">HD</td>
    </tr>
    <tr>
      <td style="text-align: left">HD-2-1_htsqct</td>
      <td style="text-align: left">HD</td>
    </tr>
    <tr>
      <td style="text-align: left">HD-1_htsqct</td>
      <td style="text-align: left">HD</td>
    </tr>
  </tbody>
</table>

<p>Similarly, we can perrk at an excerpt of the row metadata (i.e. <a href="https://bioconductor.org/packages/release/bioc/html/GenomicRanges.html">GenomicRanges</a>) using the <code class="highlighter-rouge">SummarizedExperiment::rowRanges</code> function.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r">  <span class="n">brca_hd_tep_rowRanged_df</span> <span class="o">&lt;-</span> <span class="n">as.data.frame</span><span class="p">(</span><span class="n">SummarizedExperiment</span><span class="o">::</span><span class="n">rowRanges</span><span class="p">(</span><span class="n">brca_hd_tep_se</span><span class="p">))</span>
  <span class="n">knitr</span><span class="o">::</span><span class="n">kable</span><span class="p">(</span><span class="n">head</span><span class="p">(</span><span class="n">brca_hd_tep_rowRanged_df</span><span class="p">))</span></code></pre></figure>

<table>
  <thead>
    <tr>
      <th style="text-align: left"> </th>
      <th style="text-align: left">seqnames</th>
      <th style="text-align: right">start</th>
      <th style="text-align: right">end</th>
      <th style="text-align: right">width</th>
      <th style="text-align: left">strand</th>
      <th style="text-align: left">ensembl_gene_id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">RNU6-871P</td>
      <td style="text-align: left">chr12</td>
      <td style="text-align: right">59450673</td>
      <td style="text-align: right">59450772</td>
      <td style="text-align: right">100</td>
      <td style="text-align: left">-</td>
      <td style="text-align: left">ENSG00000251931</td>
    </tr>
    <tr>
      <td style="text-align: left">MIR626</td>
      <td style="text-align: left">chr15</td>
      <td style="text-align: right">41691585</td>
      <td style="text-align: right">41691678</td>
      <td style="text-align: right">94</td>
      <td style="text-align: left">+</td>
      <td style="text-align: left">ENSG00000207766</td>
    </tr>
    <tr>
      <td style="text-align: left">RNU6-35P</td>
      <td style="text-align: left">chr4</td>
      <td style="text-align: right">109992325</td>
      <td style="text-align: right">109992431</td>
      <td style="text-align: right">107</td>
      <td style="text-align: left">+</td>
      <td style="text-align: left">ENSG00000207260</td>
    </tr>
    <tr>
      <td style="text-align: left">MIR5694</td>
      <td style="text-align: left">chr14</td>
      <td style="text-align: right">67441855</td>
      <td style="text-align: right">67441930</td>
      <td style="text-align: right">76</td>
      <td style="text-align: left">-</td>
      <td style="text-align: left">ENSG00000265993</td>
    </tr>
    <tr>
      <td style="text-align: left">RNU6-1157P</td>
      <td style="text-align: left">chr11</td>
      <td style="text-align: right">118593988</td>
      <td style="text-align: right">118594093</td>
      <td style="text-align: right">106</td>
      <td style="text-align: left">+</td>
      <td style="text-align: left">ENSG00000207185</td>
    </tr>
    <tr>
      <td style="text-align: left">RNU4-85P</td>
      <td style="text-align: left">chr3</td>
      <td style="text-align: right">19996803</td>
      <td style="text-align: right">19996925</td>
      <td style="text-align: right">123</td>
      <td style="text-align: left">+</td>
      <td style="text-align: left">ENSG00000201545</td>
    </tr>
  </tbody>
</table>

<figure class="highlight"><pre><code class="language-r" data-lang="r">  <span class="n">dim</span><span class="p">(</span><span class="n">brca_hd_tep_rowRanged_df</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [1] 34996     6</code></pre></figure>

<p>Note that we were only able to successfully map 34 996 HGNC symbols from the original Ensembl identifiers.</p>

<p>Finally, we can peek at the assay data using the <code class="highlighter-rouge">SummarizedExperiment::assay</code> function.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r">  <span class="n">knitr</span><span class="o">::</span><span class="n">kable</span><span class="p">(</span><span class="n">head</span><span class="p">(</span><span class="n">SummarizedExperiment</span><span class="o">::</span><span class="n">assays</span><span class="p">(</span><span class="n">brca_hd_tep_se</span><span class="p">)</span><span class="o">$</span><span class="n">counts</span><span class="p">)[,</span> <span class="n">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">7</span><span class="p">)])</span></code></pre></figure>

<table>
  <thead>
    <tr>
      <th style="text-align: left"> </th>
      <th style="text-align: right">MGH-BrCa-H-74_htsqct</th>
      <th style="text-align: right">MGH-BrCa-H-68_htsqct</th>
      <th style="text-align: right">HD-5_htsqct</th>
      <th style="text-align: right">HD-4_htsqct</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">RNU6-871P</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">0</td>
    </tr>
    <tr>
      <td style="text-align: left">MIR626</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">0</td>
    </tr>
    <tr>
      <td style="text-align: left">RNU6-35P</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">0</td>
    </tr>
    <tr>
      <td style="text-align: left">MIR5694</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">0</td>
    </tr>
    <tr>
      <td style="text-align: left">RNU6-1157P</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">0</td>
    </tr>
    <tr>
      <td style="text-align: left">RNU4-85P</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">0</td>
    </tr>
  </tbody>
</table>

<h2 id="d-differential-expression-testing">D. Differential Expression Testing</h2>

<p>Our approach to pathway enrichment analysis using <strong>GSEA</strong> requires a ranked list <a href="http://software.broadinstitute.org/cancer/software/gsea/wiki/index.php/Data_formats#RNK:_Ranked_list_file_format_.28.2A.rnk.29">(RNK; Ranked list file format )</a> of genes ordered according to the p-value derived form differential expression testing.</p>

<p>Our <strong>Enrichment Map</strong> pathway visualization will use files containing normalized gene expression values <a href="http://software.broadinstitute.org/cancer/software/gsea/wiki/index.php/Data_formats#TXT:_Text_file_format_for_expression_dataset_.28.2A.txt.29">(TXT; Text file format for expression dataset)</a> along with a description of each sample’s class <a href="http://software.broadinstitute.org/cancer/software/gsea/wiki/index.php/Data_formats#CLS:_Categorical_.28e.g_tumor_vs_normal.29_class_file_format_.28.2A.cls.29">(CLS; Categorical class file format)</a>). It will be convenient to generate the expression and class files alongside the RNA-Seq data transformations.</p>

<p>We will be using the <code class="highlighter-rouge">edgeR</code> Bioconductor package for RNA-Seq data transformations.</p>

<h3 id="filtering">Filtering</h3>

<p>RNA species with very low mapped read counts in a small number of samples can be highly variable. Consequently, we choose to ignore these in the search for differential expression. Best <em>et al.</em> use the rule of thumb that ‘genes with less than five (non-normalized) read counts in all samples were excluded from analyses’.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r">  <span class="n">library</span><span class="p">(</span><span class="n">edgeR</span><span class="p">)</span>

  <span class="c1">### Minimum number of mapped read counts per sample
</span>  <span class="n">min_counts</span> <span class="o">&lt;-</span> <span class="m">5</span>

  <span class="c1">### Declare baseline (i.e. control) and test classes
</span>  <span class="n">baseline_class</span> <span class="o">&lt;-</span> <span class="s2">"HD"</span>
  <span class="n">test_class</span> <span class="o">&lt;-</span> <span class="s2">"BrCa"</span>
  <span class="n">comparison</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">(</span><span class="n">baseline_class</span><span class="p">,</span> <span class="n">test_class</span><span class="p">)</span>

  <span class="n">brca_hd_tep_se_counts</span> <span class="o">&lt;-</span> <span class="n">SummarizedExperiment</span><span class="o">::</span><span class="n">assays</span><span class="p">(</span><span class="n">brca_hd_tep_se</span><span class="p">)</span><span class="o">$</span><span class="n">counts</span>
  <span class="n">brca_hd_tep_se_groups</span> <span class="o">&lt;-</span> <span class="n">SummarizedExperiment</span><span class="o">::</span><span class="n">colData</span><span class="p">(</span><span class="n">brca_hd_tep_se</span><span class="p">)</span><span class="o">$</span><span class="n">class</span>

  <span class="c1">### Find genes (rows) with a minimum number of counts
</span>  <span class="n">index_test_class</span> <span class="o">&lt;-</span> <span class="n">brca_hd_tep_se_groups</span> <span class="o">==</span> <span class="n">comparison</span><span class="p">[</span><span class="m">1</span><span class="p">]</span>
  <span class="n">index_baseline_class</span> <span class="o">&lt;-</span> <span class="n">brca_hd_tep_se_groups</span> <span class="o">==</span> <span class="n">comparison</span><span class="p">[</span><span class="m">2</span><span class="p">]</span>
  <span class="n">row_with_mincount</span> <span class="o">&lt;-</span>
    <span class="n">rowSums</span><span class="p">(</span><span class="n">edgeR</span><span class="o">::</span><span class="n">cpm</span><span class="p">(</span><span class="n">brca_hd_tep_se_counts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">min_counts</span><span class="p">)</span> <span class="o">&gt;=</span>
      <span class="n">min</span><span class="p">(</span><span class="n">sum</span><span class="p">(</span><span class="n">index_baseline_class</span><span class="p">),</span> <span class="n">sum</span><span class="p">(</span><span class="n">index_test_class</span><span class="p">))</span>

  <span class="c1">### Subset the original data accordingly
</span>  <span class="n">brca_hd_tep_dge_counts</span> <span class="o">&lt;-</span> <span class="n">brca_hd_tep_se_counts</span><span class="p">[</span><span class="n">row_with_mincount</span><span class="p">,]</span>

  <span class="c1">### Push the data into the edgeR::DGEList
</span>  <span class="n">brca_hd_tep_filtered_dge</span> <span class="o">&lt;-</span>
    <span class="n">edgeR</span><span class="o">::</span><span class="n">DGEList</span><span class="p">(</span><span class="n">counts</span> <span class="o">=</span> <span class="n">brca_hd_tep_dge_counts</span><span class="p">,</span> <span class="n">group</span> <span class="o">=</span> <span class="n">brca_hd_tep_se_groups</span><span class="p">)</span></code></pre></figure>

<p>Note that our end product is a very convenient class, the <code class="highlighter-rouge">edgeR::DGEList</code> from the <a href="https://bioconductor.org/packages/release/bioc/html/edgeR.html">edgeR package</a>.</p>

<blockquote>
  <p>The main components of an DGEList object are a matrix counts containing the integer counts, a data.frame samples containing information about the samples or libraries, and a optional data.frame genes containing annotation for the genes or genomic features. The data.frame samples contains a column lib.size for the library size or sequencing depth for each sample. If not specified by the user, the library sizes will be computed from the column sums of the counts. For classic edgeR the data.frame samples must also contain a column group, identifying the group membership of each sample.</p>
</blockquote>

<p>With this in mind, let’s take a look at the ‘counts’ component.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r">  <span class="n">knitr</span><span class="o">::</span><span class="n">kable</span><span class="p">(</span><span class="n">head</span><span class="p">(</span><span class="n">brca_hd_tep_filtered_dge</span><span class="o">$</span><span class="n">counts</span><span class="p">)[,</span> <span class="n">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">6</span><span class="p">)])</span></code></pre></figure>

<table>
  <thead>
    <tr>
      <th style="text-align: left"> </th>
      <th style="text-align: right">MGH-BrCa-H-74_htsqct</th>
      <th style="text-align: right">MGH-BrCa-H-68_htsqct</th>
      <th style="text-align: right">MGH-BrCa-H-11_htsqct</th>
      <th style="text-align: right">HD-5_htsqct</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">MAP4K5</td>
      <td style="text-align: right">255</td>
      <td style="text-align: right">520</td>
      <td style="text-align: right">854</td>
      <td style="text-align: right">238</td>
    </tr>
    <tr>
      <td style="text-align: left">SAV1</td>
      <td style="text-align: right">167</td>
      <td style="text-align: right">189</td>
      <td style="text-align: right">323</td>
      <td style="text-align: right">34</td>
    </tr>
    <tr>
      <td style="text-align: left">IRF3</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">23</td>
      <td style="text-align: right">22</td>
    </tr>
    <tr>
      <td style="text-align: left">ZC3H11A</td>
      <td style="text-align: right">80</td>
      <td style="text-align: right">145</td>
      <td style="text-align: right">181</td>
      <td style="text-align: right">16</td>
    </tr>
    <tr>
      <td style="text-align: left">NUP88</td>
      <td style="text-align: right">24</td>
      <td style="text-align: right">13</td>
      <td style="text-align: right">49</td>
      <td style="text-align: right">45</td>
    </tr>
    <tr>
      <td style="text-align: left">STXBP5-AS1</td>
      <td style="text-align: right">67</td>
      <td style="text-align: right">159</td>
      <td style="text-align: right">90</td>
      <td style="text-align: right">46</td>
    </tr>
  </tbody>
</table>

<p>Similarly, we can peek inside the ‘samples’ component.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r">  <span class="n">knitr</span><span class="o">::</span><span class="n">kable</span><span class="p">(</span><span class="n">brca_hd_tep_filtered_dge</span><span class="o">$</span><span class="n">samples</span><span class="p">)</span></code></pre></figure>

<table>
  <thead>
    <tr>
      <th style="text-align: left"> </th>
      <th style="text-align: left">group</th>
      <th style="text-align: right">lib.size</th>
      <th style="text-align: right">norm.factors</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">MGH-BrCa-H-74_htsqct</td>
      <td style="text-align: left">BrCa</td>
      <td style="text-align: right">1010942</td>
      <td style="text-align: right">1</td>
    </tr>
    <tr>
      <td style="text-align: left">MGH-BrCa-H-68_htsqct</td>
      <td style="text-align: left">BrCa</td>
      <td style="text-align: right">1458995</td>
      <td style="text-align: right">1</td>
    </tr>
    <tr>
      <td style="text-align: left">MGH-BrCa-H-66_htsqct</td>
      <td style="text-align: left">BrCa</td>
      <td style="text-align: right">1104454</td>
      <td style="text-align: right">1</td>
    </tr>
    <tr>
      <td style="text-align: left">MGH-BrCa-H-59_htsqct</td>
      <td style="text-align: left">BrCa</td>
      <td style="text-align: right">375353</td>
      <td style="text-align: right">1</td>
    </tr>
    <tr>
      <td style="text-align: left">MGH-BrCa-H-11_htsqct</td>
      <td style="text-align: left">BrCa</td>
      <td style="text-align: right">1567897</td>
      <td style="text-align: right">1</td>
    </tr>
    <tr>
      <td style="text-align: left">HD-5_htsqct</td>
      <td style="text-align: left">HD</td>
      <td style="text-align: right">978816</td>
      <td style="text-align: right">1</td>
    </tr>
    <tr>
      <td style="text-align: left">HD-4_htsqct</td>
      <td style="text-align: left">HD</td>
      <td style="text-align: right">942170</td>
      <td style="text-align: right">1</td>
    </tr>
    <tr>
      <td style="text-align: left">HD-3-1_htsqct</td>
      <td style="text-align: left">HD</td>
      <td style="text-align: right">1006665</td>
      <td style="text-align: right">1</td>
    </tr>
    <tr>
      <td style="text-align: left">HD-2-1_htsqct</td>
      <td style="text-align: left">HD</td>
      <td style="text-align: right">771351</td>
      <td style="text-align: right">1</td>
    </tr>
    <tr>
      <td style="text-align: left">HD-1_htsqct</td>
      <td style="text-align: left">HD</td>
      <td style="text-align: right">1295886</td>
      <td style="text-align: right">1</td>
    </tr>
  </tbody>
</table>

<h3 id="normalization">Normalization</h3>

<p>RNA for a sample can be sequenced to varying ‘depths’. This means that the total number of sequence reads mapped to a gene for an individual sequencing run is not necessarily constant. What most concerns us is not the absolute counts of an individual RNA species coming out of a sequencing run but rather the proportion. In practical terms, we desire a fair-comparison of RNA counts between samples that takes into account variation in depth. Our recommendation is to use a normalization technique called Trimmed mean of M-values (TMM; Robinson &amp; Oshlack 2010) that effectively standardizes counts between distinct sequencing runs by assuming that most genes are not expected to alter their expression.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r">  <span class="n">brca_hd_tep_tmm_normalized_dge</span> <span class="o">&lt;-</span> <span class="n">emRNASeq</span><span class="o">::</span><span class="n">normalize_rseq</span><span class="p">(</span><span class="n">brca_hd_tep_filtered_dge</span><span class="p">)</span>
  <span class="n">knitr</span><span class="o">::</span><span class="n">kable</span><span class="p">(</span><span class="n">brca_hd_tep_tmm_normalized_dge</span><span class="o">$</span><span class="n">samples</span><span class="p">)</span></code></pre></figure>

<table>
  <thead>
    <tr>
      <th style="text-align: left"> </th>
      <th style="text-align: left">group</th>
      <th style="text-align: right">lib.size</th>
      <th style="text-align: right">norm.factors</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">MGH-BrCa-H-74_htsqct</td>
      <td style="text-align: left">BrCa</td>
      <td style="text-align: right">1010942</td>
      <td style="text-align: right">0.8467126</td>
    </tr>
    <tr>
      <td style="text-align: left">MGH-BrCa-H-68_htsqct</td>
      <td style="text-align: left">BrCa</td>
      <td style="text-align: right">1458995</td>
      <td style="text-align: right">0.9171140</td>
    </tr>
    <tr>
      <td style="text-align: left">MGH-BrCa-H-66_htsqct</td>
      <td style="text-align: left">BrCa</td>
      <td style="text-align: right">1104454</td>
      <td style="text-align: right">1.0598800</td>
    </tr>
    <tr>
      <td style="text-align: left">MGH-BrCa-H-59_htsqct</td>
      <td style="text-align: left">BrCa</td>
      <td style="text-align: right">375353</td>
      <td style="text-align: right">0.9411707</td>
    </tr>
    <tr>
      <td style="text-align: left">MGH-BrCa-H-11_htsqct</td>
      <td style="text-align: left">BrCa</td>
      <td style="text-align: right">1567897</td>
      <td style="text-align: right">1.1394811</td>
    </tr>
    <tr>
      <td style="text-align: left">HD-5_htsqct</td>
      <td style="text-align: left">HD</td>
      <td style="text-align: right">978816</td>
      <td style="text-align: right">0.8057214</td>
    </tr>
    <tr>
      <td style="text-align: left">HD-4_htsqct</td>
      <td style="text-align: left">HD</td>
      <td style="text-align: right">942170</td>
      <td style="text-align: right">1.0404548</td>
    </tr>
    <tr>
      <td style="text-align: left">HD-3-1_htsqct</td>
      <td style="text-align: left">HD</td>
      <td style="text-align: right">1006665</td>
      <td style="text-align: right">0.9094940</td>
    </tr>
    <tr>
      <td style="text-align: left">HD-2-1_htsqct</td>
      <td style="text-align: left">HD</td>
      <td style="text-align: right">771351</td>
      <td style="text-align: right">1.1216675</td>
    </tr>
    <tr>
      <td style="text-align: left">HD-1_htsqct</td>
      <td style="text-align: left">HD</td>
      <td style="text-align: right">1295886</td>
      <td style="text-align: right">1.3247572</td>
    </tr>
  </tbody>
</table>

<p>Note that the TMM-normalized <code class="highlighter-rouge">DGEList</code> called <code class="highlighter-rouge">brca_hd_tep_tmm_normalized_dge</code> has updated column <code class="highlighter-rouge">norm.factors</code> in component ‘samples’. This value will be used to determine an ‘effective library size’, leaving the raw counts untouched.</p>

<h4 id="gene-expression-output-file">Gene expression output file</h4>

<p>As a convenient side effect of our work, we can generate an expression file of normalized RNA counts where row names are gene symbols and column names are sample IDs. We will use this later to be able to display expression for any enriched pathways in our Enrichment Map.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r">  <span class="n">brca_hd_tep_tmm_normalized_mat</span> <span class="o">&lt;-</span> <span class="n">edgeR</span><span class="o">::</span><span class="n">cpm</span><span class="p">(</span><span class="n">brca_hd_tep_tmm_normalized_dge</span><span class="p">,</span> <span class="n">normalized.lib.size</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>

  <span class="n">meta_df</span> <span class="o">&lt;-</span> <span class="n">data.frame</span><span class="p">(</span>
    <span class="n">NAME</span> <span class="o">=</span> <span class="n">rownames</span><span class="p">(</span><span class="n">brca_hd_tep_tmm_normalized_mat</span><span class="p">),</span>
    <span class="n">DESCRIPTION</span> <span class="o">=</span> <span class="n">rownames</span><span class="p">(</span><span class="n">brca_hd_tep_tmm_normalized_mat</span><span class="p">),</span>
    <span class="n">check.names</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">)</span>

  <span class="n">rownames</span><span class="p">(</span><span class="n">brca_hd_tep_tmm_normalized_mat</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="n">NULL</span>
  <span class="n">brca_hd_tep_tmm_normalized_expression_df</span> <span class="o">&lt;-</span> <span class="n">data.frame</span><span class="p">(</span><span class="n">meta_df</span><span class="p">,</span> <span class="n">brca_hd_tep_tmm_normalized_mat</span><span class="p">,</span>  <span class="n">check.names</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">)</span>

  <span class="n">knitr</span><span class="o">::</span><span class="n">kable</span><span class="p">(</span><span class="n">head</span><span class="p">(</span><span class="n">brca_hd_tep_tmm_normalized_expression_df</span><span class="p">)[,</span><span class="n">c</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">9</span><span class="p">)])</span></code></pre></figure>

<table>
  <thead>
    <tr>
      <th style="text-align: left">NAME</th>
      <th style="text-align: left">DESCRIPTION</th>
      <th style="text-align: right">MGH-BrCa-H-74_htsqct</th>
      <th style="text-align: right">MGH-BrCa-H-68_htsqct</th>
      <th style="text-align: right">HD-5_htsqct</th>
      <th style="text-align: right">HD-4_htsqct</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">MAP4K5</td>
      <td style="text-align: left">MAP4K5</td>
      <td style="text-align: right">297.905074</td>
      <td style="text-align: right">388.620956</td>
      <td style="text-align: right">301.78036</td>
      <td style="text-align: right">181.57979</td>
    </tr>
    <tr>
      <td style="text-align: left">SAV1</td>
      <td style="text-align: left">SAV1</td>
      <td style="text-align: right">195.098617</td>
      <td style="text-align: right">141.248771</td>
      <td style="text-align: right">43.11148</td>
      <td style="text-align: right">20.40222</td>
    </tr>
    <tr>
      <td style="text-align: left">IRF3</td>
      <td style="text-align: left">IRF3</td>
      <td style="text-align: right">5.841276</td>
      <td style="text-align: right">3.736740</td>
      <td style="text-align: right">27.89566</td>
      <td style="text-align: right">32.64356</td>
    </tr>
    <tr>
      <td style="text-align: left">ZC3H11A</td>
      <td style="text-align: left">ZC3H11A</td>
      <td style="text-align: right">93.460415</td>
      <td style="text-align: right">108.365459</td>
      <td style="text-align: right">20.28776</td>
      <td style="text-align: right">73.44800</td>
    </tr>
    <tr>
      <td style="text-align: left">NUP88</td>
      <td style="text-align: left">NUP88</td>
      <td style="text-align: right">28.038125</td>
      <td style="text-align: right">9.715524</td>
      <td style="text-align: right">57.05931</td>
      <td style="text-align: right">71.40778</td>
    </tr>
    <tr>
      <td style="text-align: left">STXBP5-AS1</td>
      <td style="text-align: left">STXBP5-AS1</td>
      <td style="text-align: right">78.273098</td>
      <td style="text-align: right">118.828331</td>
      <td style="text-align: right">58.32730</td>
      <td style="text-align: right">67.32734</td>
    </tr>
  </tbody>
</table>

<h3 id="differential-expression-testing">Differential expression testing</h3>

<p>In this step we perform a pair-wise comparison of RNA species counts in BrCa samples relative HD samples. The framework used to determine differential RNA expression is a ‘hypothesis-testing’ technique that entails:</p>

<ul>
  <li>Declare the null hypothesis of no difference in RNA counts for each gene</li>
  <li>Define a null distribution that describes how RNA counts vary under circumstances where there is no association between RNA counts and class</li>
  <li>Calculate the probability (p-value) of observing a difference in RNA species counts at least as extreme as the one observed assuming the null hypothesis/distribution</li>
</ul>

<figure class="highlight"><pre><code class="language-r" data-lang="r">  <span class="n">brca_hd_tep_fitted_commondisp_dge</span> <span class="o">&lt;-</span> <span class="n">edgeR</span><span class="o">::</span><span class="n">estimateCommonDisp</span><span class="p">(</span><span class="n">brca_hd_tep_tmm_normalized_dge</span><span class="p">)</span>
  <span class="n">brca_hd_tep_fitted_tagwise_dge</span> <span class="o">&lt;-</span> <span class="n">edgeR</span><span class="o">::</span><span class="n">estimateTagwiseDisp</span><span class="p">(</span><span class="n">brca_hd_tep_fitted_commondisp_dge</span><span class="p">)</span>

  <span class="n">brca_hd_tep_de_tested_dge</span> <span class="o">&lt;-</span> <span class="n">edgeR</span><span class="o">::</span><span class="n">exactTest</span><span class="p">(</span><span class="n">brca_hd_tep_fitted_tagwise_dge</span><span class="p">,</span> <span class="n">pair</span> <span class="o">=</span> <span class="n">comparison</span><span class="p">)</span>

  <span class="n">brca_hd_tep_de_tested_tt</span> <span class="o">&lt;-</span> <span class="n">edgeR</span><span class="o">::</span><span class="n">topTags</span><span class="p">(</span><span class="n">brca_hd_tep_de_tested_dge</span><span class="p">,</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">nrow</span><span class="p">(</span><span class="n">brca_hd_tep_tmm_normalized_dge</span><span class="p">),</span>
    <span class="n">adjust.method</span> <span class="o">=</span> <span class="s2">"BH"</span><span class="p">,</span>
    <span class="n">sort.by</span> <span class="o">=</span> <span class="s2">"PValue"</span><span class="p">)</span></code></pre></figure>

<p>Describe <code class="highlighter-rouge">brca_hd_tep_de_tested_tt</code></p>

<h4 id="output-file-rank-list">Output file: Rank list</h4>

<p>At this stage, we can generate a rank file where row names are gene symbols and a single column indicates the rank calculated as a function of their p-value. The larger the magnitude of the positive or negative rank, the rarer such an observation would be under the assumption of no association between class and RNA count (Table 6).</p>

<p>Describe rank file generation</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#' Generate text file content for genes ranked by a funtion of p-value for differential expression
#'
#' Creates content conforming to \href{http://software.broadinstitute.org/cancer/software/gsea/wiki/index.php/Data_formats#RNK:_Ranked_list_file_format_.28.2A.rnk.29}{GSEA's text file format for a ranked list file (.rnk)}. The column header names are arbitrary. The gene rank is based on: \eqn{sign(log(fold_change) * -log( pvalue )}.
#'
#' @param de_tested_tt This is the \code{\link[edgeR]{TopTags}} object emerging from \code{\link{process_rseq}}
#'
#' @return a \code{\link[base]{data.frame}} of the ranks
#'
#' @export
</span><span class="n">format_ranks_gsea</span> <span class="o">&lt;-</span> <span class="k">function</span><span class="p">(</span><span class="n">de_tested_tt</span><span class="p">){</span>

  <span class="n">rank_values</span> <span class="o">&lt;-</span> <span class="n">sign</span><span class="p">(</span><span class="n">de_tested_tt</span><span class="o">$</span><span class="n">table</span><span class="o">$</span><span class="n">logFC</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="m">-1</span><span class="p">)</span> <span class="o">*</span> <span class="n">log10</span><span class="p">(</span><span class="n">de_tested_tt</span><span class="o">$</span><span class="n">table</span><span class="o">$</span><span class="n">PValue</span><span class="p">)</span>
  <span class="n">rank_values_max</span> <span class="o">&lt;-</span> <span class="n">max</span><span class="p">(</span><span class="n">rank_values</span><span class="p">[</span> <span class="n">rank_values</span> <span class="o">!=</span> <span class="n">Inf</span> <span class="p">])</span>
  <span class="n">rank_values_unique</span> <span class="o">&lt;-</span> <span class="n">sapply</span><span class="p">(</span> <span class="n">rank_values</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">replace</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">is.infinite</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">sign</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">rank_values_max</span> <span class="o">+</span> <span class="n">runif</span><span class="p">(</span><span class="m">1</span><span class="p">)))</span> <span class="p">)</span>
  <span class="n">genenames</span> <span class="o">&lt;-</span> <span class="p">(</span><span class="n">rownames</span><span class="p">(</span><span class="n">de_tested_tt</span><span class="o">$</span><span class="n">table</span><span class="p">))</span>

  <span class="n">ranks_df</span> <span class="o">&lt;-</span> <span class="n">data.frame</span><span class="p">(</span><span class="n">gene</span><span class="o">=</span><span class="n">genenames</span><span class="p">,</span>
    <span class="n">rank</span><span class="o">=</span><span class="n">rank_values_unique</span><span class="p">,</span>
    <span class="n">stringsAsFactors</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">)</span>
  <span class="n">ordered_ranks_df</span> <span class="o">&lt;-</span> <span class="n">ranks_df</span><span class="p">[</span><span class="n">order</span><span class="p">(</span><span class="n">ranks_df</span><span class="p">[,</span><span class="m">2</span><span class="p">],</span> <span class="n">decreasing</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">),</span> <span class="p">]</span>

  <span class="k">return</span><span class="p">(</span><span class="n">ordered_ranks_df</span><span class="p">)</span>
<span class="p">}</span></code></pre></figure>

<h4 id="output-file-phenotypes">Output file: Phenotypes</h4>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#' Generate categorical class text file content
#'
#' Creates content conforming to \href{http://software.broadinstitute.org/cancer/software/gsea/wiki/index.php/Data_formats#CLS:_Categorical_.28e.g_tumor_vs_normal.29_class_file_format_.28.2A.cls.29}{GSEA's text file format for discrete classes}.
#'
#' @param filtered_dge A \code{\link[edgeR]{DGEList}}, typically a filtered version coming out of  \code{\link{filter_rseq}}
#' @param de_tested_tt A \code{\link[edgeR]{TopTags}}
#'
#' @return a matrix
#'
#' @export
</span><span class="n">format_class_gsea</span> <span class="o">&lt;-</span> <span class="k">function</span><span class="p">(</span><span class="n">filtered_dge</span><span class="p">,</span> <span class="n">de_tested_tt</span><span class="p">){</span>

  <span class="n">n_samples</span> <span class="o">&lt;-</span> <span class="n">dim</span><span class="p">(</span><span class="n">filtered_dge</span><span class="p">)[</span><span class="m">2</span><span class="p">]</span>
  <span class="n">n_classes</span> <span class="o">&lt;-</span> <span class="m">2</span>

  <span class="n">l1</span> <span class="o">&lt;-</span> <span class="n">paste</span><span class="p">(</span><span class="n">n_samples</span><span class="p">,</span> <span class="n">n_classes</span><span class="p">,</span> <span class="s2">"1"</span><span class="p">)</span>
  <span class="n">l2</span> <span class="o">&lt;-</span> <span class="n">paste</span><span class="p">(</span><span class="s2">"#"</span><span class="p">,</span> <span class="n">de_tested_tt</span><span class="o">$</span><span class="n">comparison</span><span class="p">[</span><span class="m">1</span><span class="p">],</span> <span class="n">de_tested_tt</span><span class="o">$</span><span class="n">comparison</span><span class="p">[</span><span class="m">2</span><span class="p">])</span>
  <span class="n">l3</span> <span class="o">&lt;-</span> <span class="n">paste</span><span class="p">(</span><span class="n">filtered_dge</span><span class="o">$</span><span class="n">samples</span><span class="o">$</span><span class="n">group</span><span class="p">,</span> <span class="n">collapse</span> <span class="o">=</span> <span class="s2">" "</span><span class="p">)</span>

  <span class="k">return</span><span class="p">(</span><span class="n">rbind</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="n">l3</span><span class="p">))</span>
<span class="p">}</span></code></pre></figure>

<h2 id="references">References</h2>
<ul>
  <li><a href="http://linkinghub.elsevier.com/retrieve/pii/S1535610815003499">Best MG <em>et al.</em> RNA-Seq of Tumor-Educated Platelets Enables Blood-Based Pan-Cancer, Multiclass, and Molecular Pathway Cancer Diagnostics. Cancer Cell. 2015 Nov 9; 28(5): 666–676</a></li>
  <li><a href="http://journals.plos.org/plosone/article?id=10.1371/journal.pone.0013984">Daniele Merico <em>et al.</em> Enrichment Map: A Network-Based Method for Gene-Set Enrichment Visualization and Interpretation. PLoS One. 2010; 5(11): e13984</a></li>
  <li><a href="https://www.ncbi.nlm.nih.gov/pubmed/21258396">Gay LJ and Felding-Habermann B. Contribution of platelets to tumour metastasis. Nat Rev Cancer. 2011 Feb;11(2):123-34</a></li>
  <li><a href="http://www.nature.com/doifinder/10.1038/nmeth.3252">Huber <em>et al.</em> Orchestrating high-throughput genomic analysis with Bioconductor. Nature Methods. 2015 Feb, 12(2)</a></li>
  <li><a href="http://genomebiology.com/2010/11/3/R25">Robinson MD and Oshlack 1. A scaling normalization method for differential expression analysis of RNA-seq data. Genome Biology 2010, 11:R25</a></li>
  <li><a href="https://www.ncbi.nlm.nih.gov/pubmed/21436837">Semple JW. <em>et al</em>. Platelets and the immune continuum. Nat Rev Immunol. 2011 Apr;11(4):264-74</a></li>
</ul>

  </div>
</div>

  

  

</div>

      </div>
    </div>

    

    <label for="sidebar-checkbox" class="sidebar-toggle" data-toggle="tooltip" data-placement="right" title="Toggle sidebar"></label>

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-43341809-8', 'auto');
  ga('send', 'pageview');

  $(document).ready(function() {
    // Link
    $('a').click(function() {
      var id = $(this).attr("href");

      var label = "link";
      var action = id;
      ga('send', 'event', label, action);
      // console.log(label + " " + action);
    });
  });
</script>

  </body>
</html>
